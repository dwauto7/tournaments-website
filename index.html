<!DOCTYPE HTML>
<html>
<head>
  <title>TournaMate - AI Blizzard Tournaments</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
  <style>
    input[type="date"], input[type="time"], input[type="number"] {
      color: #000000 !important;
      background: #ffffff !important;
    }
    .registration-info ul {
      list-style: none;
      padding-left: 0;
    }
    .registration-info li {
      position: relative;
      padding-left: 2em;
      margin-bottom: 0.5em;
    }
    .registration-info li:before {
      content: "✓";
      position: absolute;
      left: 0;
      color: #4CAF50;
      font-weight: bold;
    }
    .golf-icon {
      font-size: 4em;
      color: #4CAF50;
    }
  </style>
</head>
<body class="is-preload">
  <div id="page-wrapper">

    <!-- Header -->
    <header id="header" class="alt">
      <h1><a href="index.html">TournaMate</a></h1>
      <nav>
        <a href="#menu">Menu</a>
      </nav>
    </header>

    <!-- Menu -->
    <nav id="menu">
      <div class="inner">
        <h2>Menu</h2>
        <ul class="links">
          <li><a href="#banner">Home</a></li>
          <li><a href="#flow">How It Works</a></li>
          <li><a href="#tournaments">Tournaments</a></li>
          <li><a href="#registration">Register</a></li>
          <li><a href="#groups">View Groups</a></li>
        </ul>
        <a href="#" class="close">Close</a>
      </div>
    </nav>

    <!-- Banner -->
    <section id="banner">
      <div class="inner">
        <div class="logo">
          <span class="icon golf-icon">⛳</span>
        </div>
        <h2>TournaMate</h2>
        <p>Your AI-Powered Golf Tournament Assistant</p>
        <div class="actions special">
          <a href="#flow" class="button primary">How It Works</a>
          <a href="#tournaments" class="button">Create Tournament</a>
          <a href="#registration" class="button">Register Now</a>
          <a href="#groups" class="button">View Groups</a>
        </div>
      </div>
    </section>

    <!-- Wrapper -->
    <section id="wrapper">

      <!-- Flow -->
      <section id="flow" class="wrapper alt spotlight style1">
        <div class="inner">
          <div class="content">
            <h2 class="major">How TournaMate Works</h2>
            <div class="flow-steps">
              <div class="step"><h3>1. Select Tournament</h3><p>Browse and choose your competition.</p></div>
              <div class="step"><h3>2. Register & Provide Handicap</h3><p>Enter your details for proper grouping.</p></div>
              <div class="step"><h3>3. Smart Grouping</h3><p>12 hours before start, AI groups golfers by skill.</p></div>
              <div class="step"><h3>4. Tournament Time!</h3><p>View your group and compete!</p></div>
            </div>
            <a href="#registration" class="special">Get Started</a>
          </div>
        </div>
      </section>

      <!-- Create Tournament -->
      <section id="tournaments" class="wrapper style2">
        <div class="inner">
          <h2 class="major">Create Golf Tournament</h2>
          <p>Set up your golf tournament in minutes</p>
          <form id="tournamentForm">
            <div class="row gtr-uniform">
              <div class="col-6 col-12-xsmall">
                <label for="tournament-name">Tournament Name</label>
                <input type="text" id="tournament-name" placeholder="Enter name" required />
              </div>
              <div class="col-6 col-12-xsmall">
                <label for="tournament-type">Tournament Type</label>
                <select id="tournament-type" required>
                  <option value="golf">Golf Tournament</option>
                </select>
              </div>
              <div class="col-6 col-12-xsmall">
                <label for="start-date">Start Date</label>
                <input type="date" id="start-date" required />
              </div>
              <div class="col-6 col-12-xsmall">
                <label for="start-time">Start Time</label>
                <input type="time" id="start-time" required />
              </div>
              <div class="col-12">
                <label for="max-participants">Max Participants</label>
                <input type="number" id="max-participants" min="2" max="500" required placeholder="50" />
              </div>
              <div class="col-12">
                <button type="submit" class="button primary">Create Tournament</button>
                <p id="tournamentResponse"></p>
              </div>
            </div>
          </form>
        </div>
      </section>

      <!-- Registration -->
      <section id="registration" class="wrapper alt style3 special">
        <div class="inner">
          <header class="major">
            <h2>Register for Tournament</h2>
            <p>Select a tournament and join the competition</p>
          </header>
          <form id="registerForm">
            <div class="row gtr-uniform">
              <div class="col-6 col-12-xsmall">
                <label for="tournament-select">Select Tournament</label>
                <select id="tournament-select" required>
                  <option value="">Select Tournament</option>
                </select>
              </div>
              <div class="col-6 col-12-xsmall">
                <label for="name">Full Name</label>
                <input type="text" id="name" placeholder="Full Name" required />
              </div>
              <div class="col-6 col-12-xsmall">
                <label for="phone">Phone Number</label>
                <input type="text" id="phone" placeholder="+60123456789" required />
              </div>
              <div class="col-6 col-12-xsmall">
                <label for="email">Email Address</label>
                <input type="email" id="email" placeholder="Email Address" required />
              </div>
              <div class="col-6 col-12-xsmall">
                <label for="handicap-number">Golf Handicap</label>
                <input type="number" id="handicap-number" placeholder="0-54" min="0" max="54" step="0.1" required />
              </div>
              <div class="col-6 col-12-xsmall">
                <label for="skill-level">Skill Category</label>
                <select id="skill-level" required>
                  <option value="">Select based on handicap</option>
                  <option value="Scratch">Scratch (0 or better)</option>
                  <option value="Low">Low (1-9)</option>
                  <option value="Mid">Mid (10-19)</option>
                  <option value="High">High (20-29)</option>
                  <option value="Beginner">Beginner (30-54)</option>
                </select>
              </div>
              <div class="col-12">
                <button type="submit" class="button primary">Register Now</button>
                <p id="responseMessage"></p>
              </div>
            </div>
          </form>
          <div class="registration-info">
            <h3>What happens after registration?</h3>
            <ul>
              <li>You'll receive SMS confirmation upon successful registration.</li>
              <li>Groups are set automatically 12 hours before the tournament.</li>
              <li>Use "View Groups" to see your assigned group.</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- View Groups -->
      <section id="groups" class="wrapper style1">
        <div class="inner">
          <h2 class="major">View Tournament Groups</h2>
          <p>Check your group assignments and competitors</p>
          <form id="groupsForm">
            <div class="row gtr-uniform">
              <div class="col-8 col-12-xsmall">
                <label for="group-tournament-select">Select Tournament</label>
                <select id="group-tournament-select" required>
                  <option value="">Select Tournament</option>
                </select>
              </div>
              <div class="col-4 col-12-xsmall">
                <button type="submit" class="button primary fit" style="margin-top: 1.8em;">View Groups</button>
              </div>
            </div>
          </form>

          <div id="groupsResults" style="display:none;margin-top:2em;">
            <h3>Group Assignments</h3>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr><th>Group</th><th>Players</th><th>Average Handicap</th><th>Tee Time</th></tr>
                </thead>
                <tbody id="groupsTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

    </section>

    <!-- Footer -->
    <section id="footer">
      <div class="inner">
        <h2 class="major">Get in touch</h2>
        <p>Questions about tournaments or need assistance? Contact our team.</p>
        <ul class="contact">
          <li class="icon solid fa-envelope"><a href="#">support@aiblizzard.work</a></li>
          <li class="icon brands fa-discord"><a href="#">Join our Discord</a></li>
        </ul>
        <ul class="copyright">
          <li>&copy; TournaMate by AI Blizzard. All rights reserved.</li>
        </ul>
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/jquery.scrollex.min.js"></script>
  <script src="assets/js/browser.min.js"></script>
  <script src="assets/js/breakpoints.min.js"></script>
  <script src="assets/js/util.js"></script>
  <script src="assets/js/main.js"></script>

  <!-- Custom Scripts -->
  <script>
  // Load tournaments for dropdowns
  async function loadTournaments() {
    try {
      const res = await fetch("https://d33.app.n8n.cloud/webhook/list-tournaments");
      const tournaments = await res.json();

      const regSelect = document.getElementById('tournament-select');
      const groupSelect = document.getElementById('group-tournament-select');
      regSelect.innerHTML = '<option value="">Select Tournament</option>';
      groupSelect.innerHTML = '<option value="">Select Tournament</option>';

      tournaments.forEach(t => {
        const opt1 = new Option(t.name, t.id);
        const opt2 = new Option(t.name, t.id);
        regSelect.add(opt1);
        groupSelect.add(opt2);
      });
    } catch (err) {
      console.error("Error loading tournaments:", err);
    }
  }

  // Load tournaments on page load
  loadTournaments();

  // Create Tournament
  document.getElementById('tournamentForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const resBox = document.getElementById('tournamentResponse');

  const tournamentName = document.getElementById('tournament-name').value.trim();
  const type = document.getElementById('tournament-type').value;
  const startDate = document.getElementById('start-date').value;
  const startTime = document.getElementById('start-time').value;
  const maxParticipants = document.getElementById('max-participants').value;

  const data = {
    tournamentName,
    type,
    startDate,
    startTime,
    maxParticipants: parseInt(maxParticipants)
  };

  console.log("Sending data to n8n:", data);

  try {
    const res = await fetch("https://d33.app.n8n.cloud/webhook/create-tournament", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await res.json();
    console.log(result);
  } catch (err) {
    console.error("Network error:", err);
  }
});


  // Register Participant
  document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = {
      tournament: document.getElementById('tournament-select').value,
      name: document.getElementById('name').value,
      phone: document.getElementById('phone').value,
      email: document.getElementById('email').value,
      handicap: document.getElementById('handicap-number').value,
      skill_level: document.getElementById('skill-level').value
    };
    
    const box = document.getElementById('responseMessage');
    box.textContent = "Submitting registration...";
    box.style.color = "blue";
    
    try {
      const res = await fetch("https://d33.app.n8n.cloud/webhook/register", {
        method: "POST", 
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      
      if (res.ok) {
        box.textContent = "✅ Registration successful! You'll receive SMS confirmation shortly.";
        box.style.color = "green";
        document.getElementById('registerForm').reset();
      } else {
        box.textContent = "❌ Registration failed. Please try again.";
        box.style.color = "red";
      }
    } catch (err) {
      box.textContent = "❌ Network error submitting registration.";
      box.style.color = "red";
      console.error(err);
    }
  });

  // View Groups
  document.getElementById('groupsForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const tournamentId = document.getElementById('group-tournament-select').value;
    const tableBody = document.getElementById('groupsTableBody');
    document.getElementById('groupsResults').style.display = 'block';
    tableBody.innerHTML = '<tr><td colspan="4">Loading groups...</td></tr>';
    
    try {
      const res = await fetch(`https://d33.app.n8n.cloud/webhook/tournament-groups?tournamentId=${tournamentId}`);
      const data = await res.json();
      
      if (!data.success || !data.groups || Object.keys(data.groups).length === 0) {
        tableBody.innerHTML = '<tr><td colspan="4">Groups not available yet. Please check again later.</td></tr>';
        return;
      }
      
      let html = '';
      for (const [groupName, members] of Object.entries(data.groups)) {
        const players = members.map(m => m.name).join(', ');
        const avg = (members.reduce((sum, m) => sum + (m.handicap || 0), 0) / members.length).toFixed(1);
        html += `<tr><td>${groupName}</td><td>${players}</td><td>${avg}</td><td>—</td></tr>`;
      }
      tableBody.innerHTML = html;
    } catch (err) {
      tableBody.innerHTML = '<tr><td colspan="4">Error loading groups.</td></tr>';
      console.error(err);
    }
  });
  </script>
</body>
</html>

